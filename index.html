<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elaia - Εκδηλώσεις</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="top-bar">
  <button class="top-btn">Σύνδεση</button>
  <button class="top-btn">Εγγραφή</button>
  <button class="top-btn launch">Launch</button>
</div>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo-container">
        <img src="https://raw.githubusercontent.com/o-detective/elaia/main/2ECB64C0-85F0-4F73-96D8-C34E7E91208F.png" alt="Logo" class="logo-img" />
      </div>
      <ul class="menu">
        <li><button class="menu-btn">Γάμος</button></li>
        <li><button class="menu-btn">Βάφτιση</button></li>
        <li><button class="menu-btn">Πάρτι</button></li>
        <li><button class="menu-btn">Συνέδρια</button></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="content">

      <!-- Χάρτης Ελλάδας -->
<div class="map-container">
  <object type="image/svg+xml" data="greece.svg" class="map-svg">
    Ο χάρτης δεν φορτώθηκε. Παρακαλούμε ελέγξτε τη σύνδεσή σας ή χρησιμοποιήστε ένα σύγχρονο πρόγραμμα περιήγησης.
  </object>
</div>

      <!-- Οδηγία επιλογής -->
      <div style="text-align: center; margin-top: 20px; font-weight: bold;">
        Επιλέξτε απ’ τον χάρτη
      </div>

     <!-- AI Bar -->
<section class="ai-bar" style="margin-top: 20px;">
  <textarea id="aiInput" placeholder="Π.χ. Πού μπορώ να παντρευτώ σε νησί με θέα;"></textarea>
  <button onclick="openPopup()">Αποστολή</button>
</section>

<!-- AI Popup -->
<div id="aiPopup" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #7d8053;
  color: gold;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  z-index: 9999;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
">
  <div id="aiResponse" style="min-height: 100px;"></div>
  <textarea id="popupInput" placeholder="Συνέχισε τη συζήτηση..." style="width: 100%; margin-top: 10px;"></textarea>
  <div style="margin-top: 10px; text-align: right;">
    <button onclick="continueChat()">Αποστολή</button>
    <button onclick="closePopup()">Κλείσιμο</button>
  </div>
</div>

      <div class="search-filters">
  <div class="filter-group">
    <label for="region">Περιοχή:</label>
    <select id="region">
      <option selected disabled>Επιλέξτε περιοχή</option>
      <option>Αττικης</option>
      <option>Ευβοιας</option>
      <option>Ευρυτανιας</option>
      <option>Φωκιδας</option>
      <option>Φθιωτιδας</option>
      <option>Βοιωτιας</option>
      <option>Χαλκιδικης</option>
      <option>Ημαθιας</option>
      <option>Κιλκις</option>
      <option>Πελλας</option>
      <option>Πιεριας</option>
      <option>Σερρων</option>
      <option>Θεσσαλονικης</option>
      <option>Χανιων</option>
      <option>Ηρακλειου</option>
      <option>Λασιθιου</option>
      <option>Ρεθυμνης</option>
      <option>Δραμας</option>
      <option>Εβρου</option>
      <option>Καβαλας</option>
      <option>Ροδοπης</option>
      <option>Ξανθης</option>
      <option>Αρτας</option>
      <option>Ιωαννινων</option>
      <option>Πρεβεζας</option>
      <option>Θεσπρωτιας</option>
      <option>Κερκυρας</option>
      <option>Παξοι</option>
      <option>Κυθηρα</option>
      <option>Κεφαλληνιας</option>
      <option>Λευκαδας</option>
      <option>Ζακυνθου</option>
      <option>Ιθακης</option>
      <option>Λοιπα ιονια νησια</option>
      <option>Ικαρια</option>
      <option>Λημνος</option>
      <option>Χιου</option>
      <option>Λεσβου</option>
      <option>Σαμου</option>
      <option>Αρκαδιας</option>
      <option>Αργολιδας</option>
      <option>Κορινθιας</option>
      <option>Λακωνιας</option>
      <option>Μεσσηνιας</option>
      <option>Λοιπα νηςια Κυκλαδων</option>
      <option>Ανδρος</option>
      <option>Σαντορινη</option>
      <option>Μηλος</option>
      <option>Μυκονος</option>
      <option>Ναξος</option>
      <option>Παρος</option>
      <option>Τηνος</option>
      <option>Συρος</option>
      <option>Λοιπα νησια Δωδεκανησων</option>
      <option>Ροδος</option>
      <option>Καρπαθος</option>
      <option>Κως</option>
      <option>Αστυπαλαια</option>
      <option>Πατμος</option>
      <option>Καστελλοριζο</option>
      <option>Καρδιτσας</option>
      <option>Λαρισης</option>
      <option>Μαγνησιας</option>
      <option>Τρικαλων</option>
      <option>Αχαιας</option>
      <option>Αιτωλοακαρνανιας</option>
      <option>Ηλειας</option>
      <option>Φλωρινας</option>
      <option>Γρεβενων</option>
      <option>Καστοριας</option>
      <option>Κοζανης</option>
      <option>Θασος</option>
      <option>Σαμοθρακη</option>
      <option>Σκιαθος</option>
      <option>Σκοπελος</option>
      <option>Αλοννησος</option>
      <option>Σκυρος</option>
    </select>
  </div>

  <div class="filter-group">
    <label for="venue-type">Είδος:</label>
    <select id="venue-type">
      <option selected disabled>Επιλέξτε είδος</option>
      <option>Γαμος</option>
      <option>Βαφτιση</option>
      <option>Παρτι</option>
      <option>Συνεδρια</option>
    </select>
  </div>

  <div class="filter-group">
    <label for="pro-type">Είδος επαγγελματία:</label>
    <select id="pro-type">
      <option selected disabled>Επιλέξτε επαγγελματία</option>
      <option>Χώρος/Κτήμα</option>
      <option>Κομμωτήρια</option>
      <option>Make up artists</option>
      <option>Nail artists</option>
      <option>Φωτογράφοι</option>
      <option>DJs</option>
      <option>Διακοσμητές</option>
      <option>Catering</option>
      <option>Βιντεογράφοι</option>
      <option>Ζαχαροπλαστεία / Τούρτες</option>
      <option>Ανθοπωλεία / Ανθοστολισμοί</option>
      <option>Ενδυματολόγοι / Ράφτες</option>
      <option>Μπαρ</option>
      <option>Ενοικίαση εξοπλισμού</option>
    </select>
  </div>
</div>

<!-- Καρουζέλ τοπ χώροι + τοπ συνεργάτες -->
<section class="carousel-row">
  <!-- Πρώτο καρουζέλ -->
  <div class="carousel">
    <h2>Top χώροι του μήνα</h2>
    <div class="carousel-track">
      <div class="carousel-item">Χώρος 1</div>
      <div class="carousel-item">Χώρος 2</div>
      <div class="carousel-item">Χώρος 3</div>
    </div>
  </div>

  <!-- Δεύτερο καρουζέλ -->
  <div class="carousel">
    <h2>Top συνεργάτες του μήνα</h2>
    <div class="carousel-track">
      <div class="carousel-item">Συνεργάτης 1</div>
      <div class="carousel-item">Συνεργάτης 2</div>
      <div class="carousel-item">Συνεργάτης 3</div>
    </div>
  </div>
</section>

      <!-- Εμπνευστείτε -->
      <section class="carousel">
        <h2>Εμπνευστείτε από την Elaia</h2>
        <div class="carousel-track">
          <div class="carousel-item">Ιδέα 1</div>
          <div class="carousel-item">Ιδέα 2</div>
          <div class="carousel-item">Ιδέα 3</div>
        </div>
      </section>
    </main>
  </div>

<!-- JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // SVG λειτουργίες
    const svgObjects = document.querySelectorAll('.map-container object');
    svgObjects.forEach(obj => {
      obj.addEventListener("load", () => {
        const svgDoc = obj.contentDocument;
        if (!svgDoc) return;

        const regions = svgDoc.querySelectorAll("[data-name]");
        regions.forEach(region => {
          region.style.cursor = "pointer";
          region.addEventListener("click", () => {
            regions.forEach(r => r.classList.remove("selected"));
            region.classList.add("selected");
            alert("Επέλεξες: " + region.getAttribute("data-name"));
          });
        });
      });
    });
  });

  // AI popup λειτουργία
  let conversationHistory = [];

  function openPopup() {
    const input = document.getElementById("aiInput").value;
    if (!input.trim()) return;

    conversationHistory = [{ role: "user", content: input }];
    document.getElementById("aiPopup").style.display = "block";
    document.getElementById("popupInput").value = "";

    sendToAI(conversationHistory);
  }

  function closePopup() {
    document.getElementById("aiPopup").style.display = "none";
    document.getElementById("aiResponse").innerHTML = "";
    conversationHistory = [];
  }

  function continueChat() {
    const newInput = document.getElementById("popupInput").value;
    if (!newInput.trim()) return;

    conversationHistory.push({ role: "user", content: newInput });
    document.getElementById("popupInput").value = "";
    sendToAI(conversationHistory);
  }

  async function sendToAI(messages) {
  const responseBox = document.getElementById("aiResponse");

  // Αν είναι η πρώτη ερώτηση, πρόσθεσε system prompt
  if (!messages.find(m => m.role === "system")) {
    messages.unshift({
      role: "system",
      content: "Απάντα πάντα με φυσική, ζεστή και ανθρώπινη ελληνική γλώσσα, σαν να είσαι σύμβουλος που βοηθάει ζευγάρια να οργανώσουν την τέλεια εκδήλωση στην Ελλάδα. Απόφυγε αγγλικές λέξεις και απάντα απλά και κατανοητά."
    });
  }

  // Δείξε τι έγραψε ο χρήστης
  const lastUserMessage = messages[messages.length - 1].content;
  responseBox.innerHTML += `<div><strong>Εσύ:</strong> ${lastUserMessage}</div>`;

  // Δείξε ένδειξη αναμονής
  responseBox.innerHTML += `<div><em>Η Elaia σκέφτεται... ⏳</em></div>`;

  try {
    const res = await fetch("/.netlify/functions/ask-ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ messages })
    });

    const data = await res.json();
    const reply = data?.reply || data?.choices?.[0]?.message?.content || "⚠️ Δεν υπήρξε απάντηση.";

    conversationHistory.push({ role: "assistant", content: reply });

    // Καθαρισμός ένδειξης αναμονής
    const tempWait = responseBox.querySelector("em");
    if (tempWait) tempWait.remove();

    // Εμφάνιση απάντησης
    responseBox.innerHTML += `<div><strong>Elaia:</strong> ${reply}</div>`;
  } catch (err) {
    console.error("AI error:", err);
    responseBox.innerHTML += `<div><strong>Σφάλμα:</strong> ❌ Κάτι πήγε στραβά.</div>`;
  }
}
</script>
